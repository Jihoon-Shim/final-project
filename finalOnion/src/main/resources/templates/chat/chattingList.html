<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"	
	layout:decorate="~{layouts/layout}"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
<div class="container" layout:fragment="main">
  <h2 style="text-align: center">채팅 목록</h2>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>닉네임</th>
        <th>채팅방</th>
      </tr>
    </thead>
    <tbody>
      <tr th:each="chattingVO:${chattingVOList}" >
	    <td th:text="${chattingVO.memberVO.memberNickname}">상대방닉네임</td>
	    <td style="cursor:pointer;">
	    	<a th:text="${chattingVO.chattingRoomVO.chattingRoomTitle}"
			    th:href="|@{/goChat?otherNick=}${chattingVO.memberVO.memberNickname}|">채팅방제목</a>
	    </td>
      </tr>
    </tbody>
  </table>
  <form action="@{/profile}" method="post" id="form">
  	<input type="hidden" id="otherNick" name="otherNick" value="">
  	<input type="hidden" name="${_csrf.headerName}" value="${_csrf.token}" />
  </form>
<script type="text/javascript" th:inline="javascript" >
	 function goChatting(result){
		var otherNick = document.getElementById("otherNick");
		otherNick.value = result;
		//document.getElementById("form").submit();
		
		//var outlayId = myDatatable.row( this ).data().outlayId;
                var form = document.createElement('form');
                var objs;
                csrf = document.createElement('input');
                csrf.setAttribute('type', 'hidden');
                csrf.setAttribute('name', '${_csrf.parameterName}');
                csrf.setAttribute('value', '${_csrf.token}');
                objs = document.createElement('input');
                objs.setAttribute('type', 'hidden');
                objs.setAttribute('name', 'otherNick');
                objs.setAttribute('value', otherNick);
                form.appendChild(csrf);
                form.appendChild(objs);
                form.setAttribute('method', 'post');
                form.setAttribute('action', "profile");
                document.body.appendChild(form);
                form.submit();
		<!--/*let token = $("meta[name='_csrf']").attr("content"); 
		let header = $("meta[name='_csrf_header']").attr("content");
		let otherNick="${chattingVOList.memberVO.memberNickname}";
		$.ajax({
			type : "post",
			url : "profile",
			data:"otherNick="+otherNick,
			beforeSend : function(xhr){ 
                xhr.setRequestHeader(header,token);
			},
			success : function(result) {
				alert(1);
			}
		});*/-->
		
	}
</script>
</div>

</html>